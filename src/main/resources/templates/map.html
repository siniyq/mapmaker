<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        #sidebar {
            width: 280px;
            background-color: #fff;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        #map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .sidebar-header {
            padding: 20px;
            text-align: center;
            background-color: #4285F4;
            color: white;
        }
        
        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .place-buttons {
            padding: 20px;
        }
        
        .place-type {
            margin-bottom: 16px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .place-type:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .place-button {
            width: 100%;
            padding: 15px;
            border: none;
            background-color: #f8f9fa;
            text-align: left;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.2s;
        }
        
        .place-button:hover {
            background-color: #f1f3f4;
        }
        
        .place-button.active {
            background-color: #e8f0fe;
            color: #1a73e8;
            border-left: 4px solid #1a73e8;
        }
        
        .place-button i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .place-button .icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .place-info {
            padding: 10px 15px;
            background-color: #fafafa;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        .place-info .rating {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .place-info .stars {
            color: #FFC107;
            margin-right: 5px;
        }
        
        .place-info .count {
            color: #5f6368;
            font-size: 0.8rem;
        }
        
        footer {
            padding: 15px;
            background-color: #f2f2f2;
            text-align: center;
            font-size: 0.8rem;
            color: #5f6368;
            margin-top: auto;
        }
        
        .toggle-sidebar {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1001;
            background: white;
            border: none;
            border-radius: 4px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
        }
        
        .info-panel {
            max-width: 350px !important;
            max-height: 400px !important;
        }
        
        @media (max-width: 768px) {
            #sidebar {
                position: absolute;
                left: -280px;
                height: 100%;
                transition: left 0.3s ease;
            }
            
            #sidebar.open {
                left: 0;
            }
            
            .toggle-sidebar {
                display: flex;
            }
        }
        
        /* –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ç–∏–ø–æ–≤ –∑–∞–≤–µ–¥–µ–Ω–∏–π */
        .icon-restaurant:before { content: "üçΩÔ∏è"; }
        .icon-bar:before { content: "üç∏"; }
        .icon-cafe:before { content: "‚òï"; }
        .icon-bank:before { content: "üè¶"; }
        .icon-pharmacy:before { content: "üíä"; }
        .icon-gym:before { content: "üí™"; }
        .icon-school:before { content: "üè´"; }
        .icon-test:before { content: "üß™"; }
    </style>
</head>
<body>
    <div id="sidebar">
        <div class="sidebar-header">
            <h2>–ö–∞—Ä—Ç–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π</h2>
            <p>–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –≥–æ—Ä–æ–¥ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥–∞–º</p>
        </div>
        
        <div class="place-buttons">
            <div class="place-type">
                <button id="all-button" class="place-button active" onclick="activateButton(this, 'all')">
                    <span><span class="icon">üèôÔ∏è</span> –í—Å–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è</span>
                    <span id="all-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="all-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="all-rating">0.0</span>
                        <span class="count" id="all-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="restaurant-button" class="place-button" onclick="activateButton(this, 'restaurant')">
                    <span><span class="icon icon-restaurant"></span> –†–µ—Å—Ç–æ—Ä–∞–Ω—ã</span>
                    <span id="restaurant-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="restaurant-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="restaurant-rating">0.0</span>
                        <span class="count" id="restaurant-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="cafe-button" class="place-button" onclick="activateButton(this, 'cafe')">
                    <span><span class="icon icon-cafe"></span> –ö–∞—Ñ–µ</span>
                    <span id="cafe-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="cafe-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="cafe-rating">0.0</span>
                        <span class="count" id="cafe-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="bar-button" class="place-button" onclick="activateButton(this, 'bar')">
                    <span><span class="icon icon-bar"></span> –ë–∞—Ä—ã</span>
                    <span id="bar-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="bar-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="bar-rating">0.0</span>
                        <span class="count" id="bar-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="bank-button" class="place-button" onclick="activateButton(this, 'bank')">
                    <span><span class="icon icon-bank"></span> –ë–∞–Ω–∫–∏</span>
                    <span id="bank-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="bank-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="bank-rating">0.0</span>
                        <span class="count" id="bank-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="pharmacy-button" class="place-button" onclick="activateButton(this, 'pharmacy')">
                    <span><span class="icon icon-pharmacy"></span> –ê–ø—Ç–µ–∫–∏</span>
                    <span id="pharmacy-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="pharmacy-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="pharmacy-rating">0.0</span>
                        <span class="count" id="pharmacy-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="gym-button" class="place-button" onclick="activateButton(this, 'gym')">
                    <span><span class="icon icon-gym"></span> –°–ø–æ—Ä—Ç–∑–∞–ª—ã</span>
                    <span id="gym-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="gym-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="gym-rating">0.0</span>
                        <span class="count" id="gym-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="school-button" class="place-button" onclick="activateButton(this, 'school')">
                    <span><span class="icon icon-school"></span> –®–∫–æ–ª—ã</span>
                    <span id="school-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="school-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="school-rating">0.0</span>
                        <span class="count" id="school-total"></span>
                    </div>
                </div>
            </div>
            
            <div class="place-type">
                <button id="test-button" class="place-button" onclick="activateButton(this, 'test')">
                    <span><span class="icon icon-test"></span> –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è</span>
                    <span id="test-count"></span>
                </button>
                <div class="place-info">
                    <div>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</div>
                    <div class="rating">
                        <span class="stars" id="test-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="test-rating">0.0</span>
                        <span class="count" id="test-total"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            ¬© 2023 –ö–∞—Ä—Ç–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
        </footer>
    </div>
    
    <button class="toggle-sidebar" onclick="toggleSidebar()">‚ò∞</button>
    
    <div id="map-container">
        <div id="map"></div>
    </div>
    
    <script src="/js/heatmap.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
        function activateButton(button, type) {
            // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å active —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.place-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å active –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
            button.classList.add('active');
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–∏–ø–∞
            showHeatmap(type);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è/—Å–∫—Ä—ã—Ç–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–≤—ë–∑–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
        function setStars(elementId, rating) {
            const starsElement = document.getElementById(elementId);
            if (!starsElement) return;
            
            if (rating < 0.5) {
                starsElement.innerHTML = '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ';
                return;
            }
            
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < 5; i++) {
                if (i < fullStars) {
                    stars += '‚òÖ';
                } else if (i === fullStars && halfStar) {
                    stars += '‚òÖ';
                } else {
                    stars += '‚òÜ';
                }
            }
            
            starsElement.innerHTML = stars;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≤–µ–¥–µ–Ω–∏—è—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            // –ú–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤ –∑–∞–≤–µ–¥–µ–Ω–∏–π
            const placeTypes = ['all', 'restaurant', 'cafe', 'bar', 'bank', 'pharmacy', 'gym', 'school', 'test'];
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            placeTypes.forEach(type => {
                fetch(`/api/stats/${type}`)
                    .then(response => response.json())
                    .then(data => {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
                        document.getElementById(`${type}-rating`).textContent = data.averageRating.toFixed(1);
                        document.getElementById(`${type}-total`).textContent = `(${data.count} –º–µ—Å—Ç)`;
                        document.getElementById(`${type}-count`).textContent = data.count;
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤–µ–∑–¥—ã
                        setStars(`${type}-stars`, data.averageRating);
                    })
                    .catch(error => console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è ${type}:`, error));
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤—Å–µ—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π
            activateButton(document.getElementById('all-button'), 'all');
        });
    </script>
</body>
</html>
